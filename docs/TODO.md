# 基于股市预测模型的强化学习量化交易系统设计与实现


## 目录

1. 概述
2. 深度学习在金融市场的应用研究现状
3. 系统框架和主要内容
   1. 强化学习框架概述
   2. 环境建模——股市预测模型
      1. 时间序列模型——LSTM、pattern attention
      2. 特征提取——Pattern Convolution Filter
      3. 技术指标分析
   3. 策略行为网络——Actor
   4. 判别网络——Critic
   5. 人工先验知识——Opponent （*实验）
4. 具体实现和模型训练
5. 创新点
6. 结果与评估
7. 总结与展望

## TODO

1. 优化tushare API，获取指定股市列表的历史数据，保存本地，获取上证50成分股十年历史数据 （完成）
2. 测试回测模块，确定回测的标准接口（限定每日进行最多进行一次交易）
3. 实现PAT LSTM的keras模型，根据历史数据窗口长度可以自动适配conv层数和pooling层，提取feature map，并组建pattern attention matrix
4. 股市预测模型作为env的模拟，实现model based强化学习交易，预留策略库先验知识对接的API。
5. 使用上证50成分股进行模拟交易，得到收益走势图。
6. 完善论文。
7. 绘制框架图。


## 框架

1. 预测模型：实现对单一股票预测，保留对多支股票通过共享特征进行多头预测的接口，使用pca降维之后进行训练，卷积特征提取器对时序特征样式进行计算，利用attention机制获取时序和特征维度上的权重注意力。

2. 强化学习交易模型：env为单只股票走势，agent根据历史数据和股价预测数据作为action，每一步需要从预测模型获得一个输出，critic判别action的奖励情况。

3. 模型训练的流程：使用十年以上数据训练，分为三个阶段，预测模型训练阶段、强化模型训练阶段和测试阶段。以交易日为事件触发两个模型的训练，预测模型一边训练一边预测，将预测结果提交给agent，agent一边观察env一边观察预测结果，并作出action，critic给出一个评分，由agent进行梯度更新。保留agent可以观察battle人工策略行为的接口，为以后扩展用。

4. 回测等框架使用vnpy框架，借鉴其事件、引擎等定义方法。

5. 特征工程：时间的编码和解码函数，日线行情数据将价格的相关指标用差值表示，其他宏观经济、基本面、财务情况等使用PCA降维之后再加入特征，降维使用的是全部历史数据。
   
6. 定义基本的数据类型：

   1. stockdata类，包含交易日历，行情特征、基本面、财务、宏观经济特征
   2. dataprocess接口，包含时间编解码方法，标准化、去重、填充缺失值等方法，包含数据序列的generate方法
   3. datalocate接口，包含在stockdata上定位的方法，获取定位处的解码信息
   4. model类，包含预测模型，一个baseline为标准LSTM，一个实现类为Pattern transformer模型
   5. rl_model，使用DDPG，或者A3C算法，结合模型预测的向量训练agent。
   6. 已经定义好的tushare数据获取方法：stock、tushare util，tools